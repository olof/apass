#!/usr/bin/perl
# Copyright 2011 -- 2012, Olof Johansson <olof@ethup.se>
#
# Copying and distribution of this file, with or without 
# modification, are permitted in any medium without royalty 
# provided the copyright notice are preserved. This file is 
# offered as-is, without any warranty.

our $APP = 'apass';
our $VERSION = 0.2;

use warnings;
use strict;
use feature qw/say/;

use Getopt::Long qw/:config require_order bundling/;
use App::apass::Utils::Help qw/help error version/;
use Module::Load;

our $opts = {
	file     => "$ENV{HOME}/.apass",
	length   => 16,
	cipher   => 'Rijndael',
	debug    => 0,
	help     => sub { help(\*DATA) },
	version  => sub { version() },,
};

GetOptions($opts,
	'debug',
	'file=s',
	'cipher=s',
	'help',
	'version',
);

my $cmd = shift or help(\*DATA);
exit run($cmd, $opts, @ARGV);

sub run {
	my $cmd = shift;
	my $opts = shift;

	load "App::apass::$cmd", 'invoke';
	return invoke($opts, @_);
}

__DATA__
=head1 NAME 

apass - a password generator and manager

=head1 SYNOPSIS

 apass [options] <cmd> [cmd arguments]

 Options:
  --output          print password to stdout
  --length          specify length for new passwords
  --nospec          don't use special characters in passwords
  --file            use a database, other than ~/.apass

  --debug           print debug output to stdout
  --help            show usage information
  --version         show version information

 Commands:
  get <tag>         get password for tag
  add <tag>         generate password for tag
  regen <tag>       generate a new password for tag
  set <tag> <pass>  manually set password "pass" for tag (new or existing)
  rm <tag>          remove tag
  init              initialize database

=head1 DESCRIPTION

apass is a password manager and generator, storing your passwords
in an encrypted database. When you want to access a specific site or
service, you just run apass, specifying which tag you want to 
access, and enter your master password.

=head1 COMMANDS

=over

=item B<get>

=item B<add>

=item B<set>

=item B<regen>

=item B<rm>

=item B<init>

=back

=head1 OPTIONS

=over

=item B<--output> B<-p>

Print password to stdout when accessing with B<get>.

=item B<--help> B<-h>

Print short help text (the SYNOPSIS section of this document) to stdout.

=back

etc.
